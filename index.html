<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="LeetCode problem preparation with organized problem lists, clean solutions, and detailed explanations.">
  <meta name="keywords" content="LeetCode, algorithms, data structures, programming, interview preparation">
  <meta name="author" content="LeetCode Prep">
  <title>LeetCode Prep</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.css">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <link rel="stylesheet" href="assets/style.css">
</head>
<body>
  <div id="ribbon">
    <a href="#" id="home-btn" onclick="router.navigate('')"><span class="btn-icon">üè†</span><span class="btn-text"> Home</span></a>
    <span id="ribbon-title">LEETCODE ARTICLES</span>
    <div id="ribbon-actions">
      <button id="search-btn"><span class="btn-icon">üîç</span><span class="btn-text"> Search</span></button>
      <button id="settings-btn"><span class="btn-icon">‚öôÔ∏è</span><span class="btn-text"> Settings</span></button>
    </div>
  </div>
  <div id="container">
    <nav id="lists-sidebar">
      <ul id="lists-list"></ul>
    </nav>
    <nav id="sidebar">
      <ul id="file-list"></ul>
    </nav>
    <main id="content">
      <div class="content-inner" id="default-content">
        <div style="text-align: center; padding: 3rem 1rem; color: #656d76;">
          <div style="display: inline-block; animation: spin 1s linear infinite; font-size: 2rem; margin-bottom: 1rem;">‚è≥</div>
          <p style="margin: 0; font-size: 0.95rem;">Loading...</p>
        </div>
      </div>
    </main>
  </div>
  
  <!-- Search Modal -->
  <div id="search-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>üîç Search Problems</h3>
        <span class="close-btn" onclick="closeSearchModal()">&times;</span>
      </div>
      <div class="modal-body">
        <input type="text" id="search-input" placeholder="Search problems by title, number, or difficulty... (Ctrl+K)" autocomplete="off">
        <div class="search-filters">
          <label><input type="checkbox" id="filter-easy" checked> Easy</label>
          <label><input type="checkbox" id="filter-medium" checked> Medium</label>
          <label><input type="checkbox" id="filter-hard" checked> Hard</label>
        </div>
        <div id="search-results"></div>
      </div>
    </div>
  </div>
  
  <!-- Settings Modal -->
  <div id="settings-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>‚öôÔ∏è Settings</h3>
        <span class="close-btn" onclick="closeSettingsModal()">&times;</span>
      </div>
      <div class="modal-body">
        <div class="setting-item">
          <label for="theme-toggle">Theme:</label>
          <select id="theme-toggle">
            <option value="light">Light</option>
            <option value="dark">Dark</option>
            <option value="auto">Auto</option>
          </select>
        </div>
        <div class="setting-item">
          <label for="font-size">Font Size:</label>
          <select id="font-size">
            <option value="small">Small</option>
            <option value="normal" selected>Normal</option>
            <option value="large">Large</option>
          </select>
        </div>
        <div class="setting-item">
          <label for="layout-mode">Layout:</label>
          <select id="layout-mode">
            <option value="comfortable" selected>Comfortable</option>
            <option value="compact">Compact</option>
          </select>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    /*
    ===========================================
    DYNAMIC URL ROUTING SYSTEM
    ===========================================
    
    URLs are defined in data/lists.json using the "url" key:
    {
      "name": "Display Name",     // What users see in sidebar
      "url": "url-slug",         // What appears in browser URL  
      "file": "data_file.json"   // Which JSON file to load
    }
    
    Benefits:
    - Change display names without breaking URLs
    - Full control over URL structure
    - Fallback: generates from "name" if "url" missing
    
    Examples:
    - "name": "LeetCode 75 Master List" + "url": "lc75" ‚Üí #lc75
    - Problems: #lc75/two-sum
    
    Debug: Open browser console and run showAllURLs() 
    ===========================================
    */
    
    // Global state management
    let currentLists = [];
    let currentListData = [];
    let currentListSlug = '';
    let currentMarkdownFile = ''; 
    let listSlugMap = {};
    let slugToFileMap = {};
    let isPageReload = true; // Track if this is a page reload vs navigation
    
    // Generate URL-friendly slug from text
    function createSlug(text) {
      return text
        .toLowerCase()
        .replace(/[^a-z0-9\s-]/g, '') // Remove special characters
        .replace(/\s+/g, '-')         // Replace spaces with hyphens
        .replace(/-+/g, '-')          // Replace multiple hyphens with single
        .replace(/^-|-$/g, '');       // Remove leading/trailing hyphens
    }
    
    // Generate mappings from lists.json data
    function generateSlugMappings(lists) {
      const slugMap = {};
      const fileMap = {};
      
      lists.forEach(list => {
        // Use the explicit 'url' key if available, otherwise fall back to generating from name
        const slug = list.url || createSlug(list.name);
        
        // Handle potential duplicates by adding number suffix
        let finalSlug = slug;
        let counter = 1;
        while (Object.values(slugMap).includes(finalSlug)) {
          finalSlug = `${slug}-${counter}`;
          counter++;
        }
        
        slugMap[list.file] = finalSlug;
        fileMap[finalSlug] = list.file;
      });
      
      return { slugMap, fileMap };
    }

    // Router class for URL management
    class Router {
      constructor() {
        this.routes = {};
        this.currentRoute = null;
        this.initialLoadComplete = false;
        
        // Listen for hash changes
        window.addEventListener('hashchange', () => this.handleRoute());
        window.addEventListener('load', () => {
          // Delay initial route handling to prevent welcome flash
          setTimeout(() => {
            this.initialLoadComplete = true;
            this.handleRoute();
          }, 50); // Small delay to let DOM settle
        });
      }
      
      // Parse current URL hash
      parseHash() {
        const hash = window.location.hash.slice(1); // Remove #
        if (!hash) return { listSlug: null, problemSlug: null };
        
        const parts = hash.split('/');
        return {
          listSlug: parts[0] || null,
          problemSlug: parts[1] || null
        };
      }
      
      // Navigate to a specific route
      navigate(listSlug, problemSlug = null) {
        isPageReload = false; // This is navigation, not a page reload
        const url = problemSlug ? `#${listSlug}/${problemSlug}` : `#${listSlug}`;
        window.location.hash = url;
      }
      
      // Handle route changes
      handleRoute() {
        const { listSlug, problemSlug } = this.parseHash();

        // If lists aren't loaded yet and we have a route, wait for them
        if (currentLists.length === 0 && (listSlug || problemSlug)) {
          return; // Keep current content and wait for lists to load
        }

        // During initial load, show loading indicator if we expect to load content
        if (!this.initialLoadComplete && (listSlug || problemSlug)) {
          document.getElementById('content').innerHTML = `
            <div class="content-inner">
              <div style="text-align: center; padding: 3rem 1rem; color: #656d76;">
                <div style="display: inline-block; animation: spin 1s linear infinite; font-size: 2rem; margin-bottom: 1rem;">‚è≥</div>
                <p style="margin: 0; font-size: 0.95rem;">Loading content...</p>
              </div>
              <div class="author-footnote">
                Made with <span class="heart">‚ô•</span> by Durga Ganesh using AI
              </div>
            </div>
          `;
        }

        if (listSlug && slugToFileMap[listSlug]) {
          // Load the specific list
          const fileName = slugToFileMap[listSlug];
          const listName = this.getListNameFromFile(fileName);

          // Update page title
          document.title = problemSlug ? `${listName} - LeetCode Prep` : `${listName} - LeetCode Prep`;

          // Set active list in sidebar
          this.setActiveList(listName);

          // Load the list data
          loadCodeListFiles(fileName, () => {
            if (problemSlug) {
              // Load specific problem
              this.loadProblemBySlug(problemSlug);
            } else {
              // Show list info in C3 with author footnote
              const listInfo = currentLists.find(l => l.file === fileName);
              const listName = listInfo ? listInfo.name : 'Problem List';
              document.getElementById('content').innerHTML = `
                <div class="content-inner">
                  <div class="action-buttons">
                    <button id="start-btn" style="background: #6f42c1; color: white; border: none; padding: 0.2em 0.5em; border-radius: 3px; cursor: pointer; font-weight: 500; font-size: 0.65em; margin-right: 0.5em;">‚ñ∂Ô∏è Start</button>
                    <button id="random-btn" style="background: #dc3545; color: white; border: none; padding: 0.2em 0.5em; border-radius: 3px; cursor: pointer; font-weight: 500; font-size: 0.65em; margin-right: 0.5em;">üé≤ Random</button>
                    <button id="share-list-btn" style="background: #28a745; color: white; border: none; padding: 0.2em 0.5em; border-radius: 3px; cursor: pointer; font-weight: 500; font-size: 0.65em;">üîó Share List</button>
                  </div>
                  <h2>${listName}</h2>
                  <p>Select a problem from the list to view its solution and explanation.</p>
                  <p><strong>${currentListData.length}</strong> problems in this list</p>
                  <div class="author-footnote">
                    Made with <span class="heart">‚ô•</span> by Durga Ganesh using AI
                  </div>
                </div>
              `;
              // Re-attach event listeners for the buttons
              document.getElementById('start-btn').onclick = function() {
                if (currentListData.length > 0) {
                  document.getElementById('content').innerHTML = `
                    <div class=\"content-inner\">
                      <div style=\"text-align: center; padding: 3rem 1rem; color: #656d76;\">
                        <div style=\"display: inline-block; animation: spin 1s linear infinite; font-size: 2rem; margin-bottom: 1rem;\">‚è≥</div>
                        <p style=\"margin: 0; font-size: 0.95rem;\">Loading content...</p>
                      </div>
                      <div class=\"author-footnote\">
                        Made with <span class=\"heart\">‚ô•</span> by Durga Ganesh using AI
                      </div>
                    </div>
                  `;
                  document.title = `${currentListData[0].title} - LeetCode Prep`;
                  router.navigate(currentListSlug, currentListData[0].slug);
                }
              };
              document.getElementById('random-btn').onclick = function() {
                if (currentListData.length > 0) {
                  const randomIndex = Math.floor(Math.random() * currentListData.length);
                  const randomProblem = currentListData[randomIndex];
                  document.getElementById('content').innerHTML = `
                    <div class=\"content-inner\">
                      <div style=\"text-align: center; padding: 3rem 1rem; color: #656d76;\">
                        <div style=\"display: inline-block; animation: spin 1s linear infinite; font-size: 2rem; margin-bottom: 1rem;\">‚è≥</div>
                        <p style=\"margin: 0; font-size: 0.95rem;\">Loading random problem...</p>
                      </div>
                      <div class=\"author-footnote\">
                        Made with <span class=\"heart\">‚ô•</span> by Durga Ganesh using AI
                      </div>
                    </div>
                  `;
                  document.title = `${randomProblem.title} - LeetCode Prep`;
                  router.navigate(currentListSlug, randomProblem.slug);
                }
              };
              document.getElementById('share-list-btn').onclick = function() {
                const listUrl = `${window.location.origin}${window.location.pathname}#${currentListSlug}`;
                shareUrl(listUrl, `${listName} - LeetCode Prep`);
              };
            }
          });
        } else if (listSlug && !slugToFileMap[listSlug] && currentLists.length > 0) {
          // Invalid list slug (only show error after lists are loaded)
          document.title = 'Not Found - LeetCode Prep';
          document.getElementById('content').innerHTML = `
            <div class="content-inner">
              <h2>List Not Found</h2>
              <p>The requested list "<strong>${listSlug}</strong>" does not exist.</p>
              <p><a href="#" onclick="router.navigate('')">‚Üê Back to Home</a></p>
              <div class="author-footnote">
                Made with <span class="heart">‚ô•</span> by Durga Ganesh using AI
              </div>
            </div>
          `;
          document.querySelectorAll('#lists-sidebar a, #sidebar a').forEach(el => {
            el.classList.remove('active');
          });
          document.getElementById('file-list').innerHTML = '';
        } else if (!listSlug && this.initialLoadComplete) {
          // Home route - show welcome message (only after initial load is complete)
          document.title = 'LeetCode Prep';
          this.showWelcome();
        }
      }
      
      // Get list name from filename
      getListNameFromFile(fileName) {
        const list = currentLists.find(l => l.file === fileName);
        return list ? list.name : '';
      }
      
      // Set active list in C1
      setActiveList(listName) {
        document.querySelectorAll('#lists-sidebar a').forEach(el => {
          el.classList.toggle('active', el.textContent === listName);
        });
      }
      
      // Load problem by slug
      loadProblemBySlug(problemSlug) {
        const problem = currentListData.find(p => p.slug === problemSlug);
        if (problem) {
          // Set title (in case this wasn't called from onclick handler)
          document.title = `${problem.title} - LeetCode Prep`;
          
          // Only show loading animation if content area doesn't already have it
          const currentContent = document.getElementById('content').innerHTML;
          if (!currentContent.includes('Loading content...')) {
            document.getElementById('content').innerHTML = `
              <div class="content-inner">
                <div style="text-align: center; padding: 3rem 1rem; color: #656d76;">
                  <div style="display: inline-block; animation: spin 1s linear infinite; font-size: 2rem; margin-bottom: 1rem;">‚è≥</div>
                  <p style="margin: 0; font-size: 0.95rem;">Loading content...</p>
                </div>
              </div>
            `;
          }
          
          const filename = `${problem.number}-${problem.slug}.md`;
          loadMarkdown(filename);
          
          // Set active problem in C2
          document.querySelectorAll('#sidebar a').forEach(el => {
            const isActive = el.textContent === problem.title;
            el.classList.toggle('active', isActive);
          });
          
          // Scroll to the active problem in C2
          scrollToActiveProblem();
        } else {
          // Problem not found in current list
          document.title = 'Problem Not Found - LeetCode Prep';
          document.getElementById('content').innerHTML = `
            <div class="content-inner">
              <h2>Problem Not Found</h2>
              <p>The problem "<strong>${problemSlug}</strong>" was not found in the current list.</p>
              <p><a href="#${currentListSlug}" onclick="router.navigate('${currentListSlug}')">‚Üê Back to List</a></p>
            </div>
          `;
          document.querySelectorAll('#sidebar a').forEach(el => {
            el.classList.remove('active');
          });
        }
      }
      
      // Show welcome message
      showWelcome() {
        // Generate dynamic examples from available lists
        const exampleLinks = currentLists.slice(0, 4).map(list => {
          const slug = listSlugMap[list.file];
          return `<li><a href="#${slug}">${list.name}</a></li>`;
        }).join('');

        // Add example problem link if we have LeetCode All
        const leetcodeAll = currentLists.find(l => l.name.includes('LeetCode-All'));
        const exampleProblem = leetcodeAll ? 
          `<li><a href="#${listSlugMap[leetcodeAll.file]}/two-sum">Two Sum Problem (example)</a></li>` : '';

        document.getElementById('content').innerHTML = `
          <div class="content-inner">
            <div class="action-buttons">
              <button id="share-website-btn" style="background: #28a745; color: white; border: none; padding: 0.2em 0.5em; border-radius: 3px; cursor: pointer; font-weight: 500; font-size: 0.65em;">üîó Share Website</button>
            </div>
            <h2>Welcome to LeetCode Prep</h2>
            <p>Select a list from the sidebar to get started, or try these direct links:</p>
            <ul>
              ${exampleLinks}
              ${exampleProblem}
            </ul>
            <p><em>You can bookmark any problem page or share direct links!</em></p>
            <div class="author-footnote">
              Made with <span class="heart">‚ô•</span> by Durga Ganesh using AI
            </div>
          </div>
        `;

        // Add event listener for website share button
        document.getElementById('share-website-btn').onclick = function() {
          const websiteUrl = `${window.location.origin}${window.location.pathname}`;
          shareUrl(websiteUrl, 'LeetCode Prep - Algorithm Problem Solutions');
        };

        // Reset all scroll positions when going to home
        resetColumnScrolls(['c1', 'c2']);
        currentMarkdownFile = ''; // Clear current file tracker

        document.querySelectorAll('#lists-sidebar a, #sidebar a').forEach(el => {
          el.classList.remove('active');
        });
        document.getElementById('file-list').innerHTML = '';
      }
    }
    
    // Initialize router
    const router = new Router();
    
    // Smart scrolling function to keep active problem visible in C2
    function scrollToActiveProblem() {
      setTimeout(() => {
        const activeLink = document.querySelector('#sidebar a.active');
        if (activeLink) {
          const sidebar = document.getElementById('sidebar');
          const sidebarRect = sidebar.getBoundingClientRect();
          const linkRect = activeLink.getBoundingClientRect();
          
          // Add padding to trigger scroll before item goes completely out of view
          const padding = 60; // pixels of buffer space
          
          // Check if link is outside visible area (with padding)
          const isAbove = linkRect.top < (sidebarRect.top + padding);
          const isBelow = linkRect.bottom > (sidebarRect.bottom - padding);
          
          if (isAbove || isBelow) {
            // Calculate the position to center the active link
            const sidebarScrollTop = sidebar.scrollTop;
            const sidebarHeight = sidebar.clientHeight;
            const linkOffsetTop = activeLink.offsetTop;
            const linkHeight = activeLink.offsetHeight;
            
            // Center the link in the sidebar
            const targetScrollTop = linkOffsetTop - (sidebarHeight / 2) + (linkHeight / 2);
            
            // Smooth scroll to the target position
            sidebar.scrollTo({
              top: Math.max(0, targetScrollTop),
              behavior: 'smooth'
            });
          }
        }
      }, 100); // Small delay to ensure DOM is updated
    }
    
    // Scroll Position Management System (C1 and C2 only)
    function saveScrollPositions() {
      // Save C1 and C2 scroll positions (always preserve these)
      localStorage.setItem('c1ScrollPosition', document.getElementById('lists-sidebar').scrollTop);
      localStorage.setItem('c2ScrollPosition', document.getElementById('sidebar').scrollTop);
    }
    
    function restoreScrollPositions() {
      // Restore C1 position immediately without delay
      const c1Scroll = localStorage.getItem('c1ScrollPosition');
      if (c1Scroll !== null) {
        document.getElementById('lists-sidebar').scrollTop = parseInt(c1Scroll);
      }
    }
    
    function restoreC2ScrollPosition() {
      // Restore C2 position immediately without delay
      const c2Scroll = localStorage.getItem('c2ScrollPosition');
      if (c2Scroll !== null) {
        document.getElementById('sidebar').scrollTop = parseInt(c2Scroll);
      }
    }
    
    function resetColumnScrolls(columns = ['c1', 'c2']) {
      // Reset specified columns to top
      if (columns.includes('c1')) {
        document.getElementById('lists-sidebar').scrollTop = 0;
        localStorage.removeItem('c1ScrollPosition');
      }
      if (columns.includes('c2')) {
        document.getElementById('sidebar').scrollTop = 0;
        localStorage.removeItem('c2ScrollPosition');
      }
    }
    
    // Modal Management
    function openSearchModal() {
      document.getElementById('search-modal').style.display = 'block';
      document.getElementById('search-input').focus();
      populateSearchResults();
    }
    
    function closeSearchModal() {
      document.getElementById('search-modal').style.display = 'none';
      document.getElementById('search-input').value = '';
    }
    
    function openSettingsModal() {
      document.getElementById('settings-modal').style.display = 'block';
      loadSettings();
    }
    
    function closeSettingsModal() {
      document.getElementById('settings-modal').style.display = 'none';
      saveSettings();
    }
    
    // Search Functionality
    let allProblems = [];
    
    function populateSearchResults(searchTerm = '') {
      if (allProblems.length === 0) {
        // Load all problems from all lists
        Promise.all(currentLists.map(list => 
          fetch(`data/${list.file}`).then(res => res.json())
          .then(problems => problems.map(p => ({...p, listName: list.name, listSlug: listSlugMap[list.file]})))
        )).then(results => {
          allProblems = results.flat();
          displaySearchResults(filterProblems(searchTerm));
        });
      } else {
        displaySearchResults(filterProblems(searchTerm));
      }
    }
    
    function filterProblems(searchTerm) {
      const easy = document.getElementById('filter-easy').checked;
      const medium = document.getElementById('filter-medium').checked;
      const hard = document.getElementById('filter-hard').checked;
      
      return allProblems.filter(problem => {
        const matchesTerm = !searchTerm || 
          problem.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
          problem.number.toString().includes(searchTerm) ||
          problem.difficulty.toLowerCase().includes(searchTerm.toLowerCase());
          
        const matchesDifficulty = 
          (easy && problem.difficulty === 'Easy') ||
          (medium && problem.difficulty === 'Medium') ||
          (hard && problem.difficulty === 'Hard');
          
        return matchesTerm && matchesDifficulty;
      }).slice(0, 50); // Limit to 50 results
    }
    
    function displaySearchResults(problems) {
      const resultsDiv = document.getElementById('search-results');
      
      if (problems.length === 0) {
        resultsDiv.innerHTML = '<div style="padding: 1em; text-align: center; color: #656d76;">No problems found</div>';
        return;
      }
      
      resultsDiv.innerHTML = problems.map(problem => `
        <div class="search-result-item" onclick="navigateToProblem('${problem.listSlug}', '${problem.slug}')">
          <div class="search-result-title">${problem.number}. ${problem.title}</div>
          <div class="search-result-meta">${problem.difficulty} ‚Ä¢ ${problem.listName}</div>
        </div>
      `).join('');
    }
    
    function navigateToProblem(listSlug, problemSlug) {
      closeSearchModal();
      router.navigate(listSlug, problemSlug);
    }
    
    // Settings Functionality
    function loadSettings() {
      const theme = localStorage.getItem('theme') || 'light';
      const fontSize = localStorage.getItem('fontSize') || 'normal';
      const layout = localStorage.getItem('layout') || 'comfortable';
      
      document.getElementById('theme-toggle').value = theme;
      document.getElementById('font-size').value = fontSize;
      document.getElementById('layout-mode').value = layout;
    }
    
    function saveSettings() {
      const theme = document.getElementById('theme-toggle').value;
      const fontSize = document.getElementById('font-size').value;
      const layout = document.getElementById('layout-mode').value;
      
      localStorage.setItem('theme', theme);
      localStorage.setItem('fontSize', fontSize);
      localStorage.setItem('layout', layout);
      
      applySettings();
    }
    
    function applySettings() {
      const theme = localStorage.getItem('theme') || 'light';
      const fontSize = localStorage.getItem('fontSize') || 'normal';
      const layout = localStorage.getItem('layout') || 'comfortable';
      
      // Apply theme (placeholder for future dark mode)
      document.body.className = `theme-${theme} font-${fontSize} layout-${layout}`;
    }
    
    // Reusable share function
    function shareUrl(url, title) {
      if (navigator.share) {
        // Use native sharing if available
        navigator.share({
          title: title,
          url: url
        });
      } else if (navigator.clipboard) {
        // Copy to clipboard
        navigator.clipboard.writeText(url).then(() => {
          // Find the active share button and show feedback
          const activeBtn = document.querySelector('#share-website-btn, #share-list-btn, #share-btn');
          if (activeBtn) {
            const originalText = activeBtn.innerHTML;
            activeBtn.innerHTML = '‚úì Copied!';
            setTimeout(() => {
              activeBtn.innerHTML = originalText;
            }, 2000);
          }
        });
      } else {
        // Fallback - show URL in alert
        alert(`Share this URL: ${url}`);
      }
    }

    // Global function to share current page (for onclick handlers)
    window.shareCurrentPage = function() {
      const currentUrl = window.location.href;
      const { problemSlug } = router.parseHash();
      const problem = currentListData.find(p => p.slug === problemSlug);
      const title = problem ? `${problem.title} - LeetCode Prep` : document.title;
      shareUrl(currentUrl, title);
    };

    // Utility function to show all generated URLs (for debugging)
    window.showAllURLs = function() {
      console.log('\n=== All Generated URLs ===');
      currentLists.forEach(list => {
        const slug = listSlugMap[list.file];
        console.log(`${list.name}:`);
        console.log(`  List URL: ${window.location.origin}${window.location.pathname}#${slug}`);
        console.log(`  Example Problem: ${window.location.origin}${window.location.pathname}#${slug}/two-sum`);
        console.log('');
      });
      console.log('Call this function anytime in the browser console to see current URLs!');
    };

    // Initial render: only lists in column 1
    fetch('data/lists.json')
      .then(res => res.json())
      .then(codeLists => {
        currentLists = codeLists;
        
        // Generate slug mappings dynamically from the lists
        const { slugMap, fileMap } = generateSlugMappings(codeLists);
        listSlugMap = slugMap;
        slugToFileMap = fileMap;
        
        // Debug: Log the generated URL mappings
        console.log('Generated URL mappings:');
        Object.entries(listSlugMap).forEach(([file, slug]) => {
          const list = codeLists.find(l => l.file === file);
          const displayName = list?.name || 'Unknown';
          const urlKey = list?.url ? ` (from url: "${list.url}")` : ' (generated from name)';
          console.log(`  "${displayName}" ‚Üí #${slug}${urlKey}`);
        });
        
        const listsList = document.getElementById('lists-list');
        listsList.innerHTML = '';
        
        codeLists.forEach(list => {
          const li = document.createElement('li');
          const a = document.createElement('a');
          const listSlug = listSlugMap[list.file];
          
          a.href = `#${listSlug}`;
          a.textContent = list.name;
          a.onclick = (e) => {
            e.preventDefault();
            router.navigate(listSlug);
          };
          li.appendChild(a);
          listsList.appendChild(li);
        });
        
        // Handle initial route after lists are loaded
        router.handleRoute();
        
        // Final fallback: if no specific content was loaded and we're at home, show welcome
        setTimeout(() => {
          const { listSlug, problemSlug } = router.parseHash();
          if (!listSlug && !problemSlug) {
            const currentContent = document.getElementById('content').innerHTML;
            // Only show welcome if content is still the default or loading
            if (currentContent.includes('Welcome') && currentContent.includes('Select a file') || 
                currentContent.includes('Loading content...')) {
              router.showWelcome();
            }
          }
        }, 100);
        
        // Set up scroll position management after DOM is ready
        setTimeout(() => {
          // Add scroll event listeners to save positions (C1 and C2 only)
          document.getElementById('lists-sidebar').addEventListener('scroll', saveScrollPositions);
          document.getElementById('sidebar').addEventListener('scroll', saveScrollPositions);
          
          // Restore C1 scroll position immediately for page reloads
          if (isPageReload) {
            restoreScrollPositions();
          }
          
          // After initial setup, mark subsequent navigations as not page reloads
          setTimeout(() => {
            isPageReload = false;
          }, 500);
        }, 50);
        
        // Add event listeners for ribbon buttons
        document.getElementById('search-btn').addEventListener('click', openSearchModal);
        document.getElementById('settings-btn').addEventListener('click', openSettingsModal);
        
        // Search input event listener
        document.getElementById('search-input').addEventListener('input', (e) => {
          populateSearchResults(e.target.value);
        });
        
        // Filter checkboxes event listeners
        ['filter-easy', 'filter-medium', 'filter-hard'].forEach(id => {
          document.getElementById(id).addEventListener('change', () => {
            populateSearchResults(document.getElementById('search-input').value);
          });
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
          // Ctrl+K or Cmd+K for search
          if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            openSearchModal();
          }
          // Escape to close modals
          if (e.key === 'Escape') {
            closeSearchModal();
            closeSettingsModal();
          }
        });
        
        // Close modals when clicking outside
        window.addEventListener('click', (e) => {
          if (e.target.classList.contains('modal')) {
            closeSearchModal();
            closeSettingsModal();
          }
        });
        
        // Apply saved settings on load
        applySettings();
        
        // Fix mobile hover states - prevent sticky hover on touch devices
        if ('ontouchstart' in window) {
          // Add touch event listeners to clear hover states
          document.addEventListener('touchstart', function() {
            // Remove any lingering hover classes
            document.querySelectorAll('#lists-sidebar a:hover, #sidebar a:hover').forEach(el => {
              el.blur();
            });
          });
          
          // Clear hover states when touching anywhere
          document.addEventListener('touchend', function() {
            setTimeout(() => {
              document.querySelectorAll('#lists-sidebar a, #sidebar a').forEach(el => {
                if (!el.classList.contains('active')) {
                  el.style.background = '#eaecef';
                  el.style.color = '#24292f';
                  el.style.fontWeight = '400';
                  el.style.boxShadow = 'none';
                  el.style.border = '1px solid transparent';
                }
              });
            }, 10);
          });
        }
      });

    const fileList = document.getElementById('file-list');
    const content = document.getElementById('content');

    // Load markdown file
    function loadMarkdown(filename) {
      // Always start C3 at the top for any content
      currentMarkdownFile = filename;
      
      // Check if we already have loading content (to avoid double delays)
      const currentContent = document.getElementById('content').innerHTML;
      const alreadyLoading = currentContent.includes('Loading content...');
      
      // Only show loading indicator if content area doesn't already have it
      if (!alreadyLoading) {
        document.getElementById('content').innerHTML = `
          <div class="content-inner">
            <div style="text-align: center; padding: 3rem 1rem; color: #656d76;">
              <div style="display: inline-block; animation: spin 1s linear infinite; font-size: 2rem; margin-bottom: 1rem;">‚è≥</div>
              <p style="margin: 0; font-size: 0.95rem;">Loading content...</p>
            </div>
          </div>
        `;
      }
      
      // Track start time for minimum loading duration
      const loadStartTime = Date.now();
      const minimumLoadTime = alreadyLoading ? 0 : 500; // No minimum delay if already loading
      
      fetch('md/' + filename)
        .then(res => {
          if (!res.ok) {
            // Custom error message, not the full HTML
            document.getElementById('content').innerHTML = `
              <div class="content-inner">
                <h2>File Not Found</h2>
                <p>The requested markdown file does not exist.</p>
              </div>
            `;
            // Update title for error state
            document.title = 'File Not Found - LeetCode Prep';
            return Promise.reject('File not found');
          }
          return res.text();
        })
        .then(md => {
          // Process markdown for special formatting
          md = enhanceMarkdown(md);

          // Calculate remaining time to ensure minimum loading duration
          const loadTime = Date.now() - loadStartTime;
          const remainingTime = Math.max(0, minimumLoadTime - loadTime);

          // Delay content display to ensure minimum loading time
          setTimeout(() => {
            // Generate navigation buttons
            const navigationButtons = generateNavigationButtons(filename);

          // Feedback button HTML (styled like other action buttons, yellow color)
          const feedbackButton = `<button id="feedback-btn" style="background: #f6c700; color: #222; border: none; padding: 0.2em 0.5em; border-radius: 3px; cursor: pointer; font-weight: 500; font-size: 0.65em; margin-left: 0.5em;">üí¨ Feedback</button>`;

          // Insert feedback button next to Print button in navigationButtons.top
          let navTop = navigationButtons.top;
          navTop = navTop.replace(new RegExp('(<button[^>]*id="print-btn"[^>]*>[^<]*<\\/button>)'), `$1${feedbackButton}`);

          document.getElementById('content').innerHTML = `
            <div class="content-inner">
              ${navTop}
              ${marked.parse(md)}
              <div class="author-footnote">
                Made with <span class="heart">‚ô•</span> by Durga Ganesh using AI
              </div>
            </div>
          `;

            // Add difficulty badges
            addDifficultyBadges();

            // Hide Practice links for printing
            hidePracticeLinksForPrint();

            // Add navigation event listeners
            setupNavigationListeners();
            document.querySelectorAll('pre code').forEach((block) => {
              hljs.highlightElement(block);
            });

            // Feedback button logic
            const feedbackBtn = document.getElementById('feedback-btn');
            if (feedbackBtn) {
              feedbackBtn.onclick = function() {
                // Try to get problem title from page
                let problemTitle = document.title.replace(' - LeetCode Prep', '');
                let pageUrl = window.location.href;
                let body = `**Feedback for:** ${problemTitle}\n\n**Page:** ${pageUrl}\n\n**Feedback:**\n`;
                let issueUrl =
                  'https://github.com/structured-lc/structured-lc.github.io/issues/new' +
                  '?title=' + encodeURIComponent('Feedback: ' + problemTitle) +
                  '&body=' + encodeURIComponent(body) +
                  '&labels=feedback';
                window.open(issueUrl, '_blank');
              };
            }

            // Always start at top of content
            document.getElementById('content').scrollTop = 0;
          }, remainingTime);
        })
        .catch(() => {
          // Already handled above
        });
    }

    // Enhance markdown with special formatting
    function enhanceMarkdown(md) {
      // Add difficulty badges at the beginning of the line
      md = md.replace(/### Leetcode (\d+) \((\w+)\): (.+)/g, 
        '### <span class="difficulty-badge $2">$2</span>Leetcode $1: $3');
      
      // Make examples more compact - use bold instead of headers
      md = md.replace(/\*\*Example (\d+):\*\*/g, 
        '**Example $1:**');
      
      // Enhance explanation formatting
      md = md.replace(/\*Explanation:/g, 
        'üí° *Explanation:');
      
      // Add hint icon for hints
      md = md.replace(/\*Hint:/g, 
        'üí° *Hint:');
      
      return md;
    }

    // Generate navigation buttons for prev/next problems
    function generateNavigationButtons(currentFilename) {
      if (!currentListData || currentListData.length === 0) {
        return { top: '' };
      }
      
      // Find current problem index
      const currentProblem = currentListData.find(p => `${p.number}-${p.slug}.md` === currentFilename);
      if (!currentProblem) {
        return { top: '' };
      }
      
      const currentIndex = currentListData.indexOf(currentProblem);
      const prevProblem = currentIndex > 0 ? currentListData[currentIndex - 1] : null;
      const nextProblem = currentIndex < currentListData.length - 1 ? currentListData[currentIndex + 1] : null;
      
      const prevButton = prevProblem ? 
        `<button onclick="
           // Show loading animation immediately
           document.getElementById('content').innerHTML = \`
             <div class='content-inner'>
               <div style='text-align: center; padding: 3rem 1rem; color: #656d76;'>
                 <div style='display: inline-block; animation: spin 1s linear infinite; font-size: 2rem; margin-bottom: 1rem;'>‚è≥</div>
                 <p style='margin: 0; font-size: 0.95rem;'>Loading content...</p>
               </div>
             </div>
           \`;
           // Set title immediately
           document.title = '${prevProblem.title} - LeetCode Prep';
           // Navigate and scroll to visible
           router.navigate('${currentListSlug}', '${prevProblem.slug}');
         " 
                 title="${prevProblem.title}"
                 style="background: #6f42c1; color: white; border: none; padding: 0.2em 0.5em; border-radius: 3px; cursor: pointer; font-weight: 500; font-size: 0.65em;">
           ‚Üê Prev
         </button>` :
        `<button disabled 
                 style="background: #f6f8fa; color: #8c959f; border: 1px solid #e1e5e9; padding: 0.2em 0.5em; border-radius: 3px; cursor: not-allowed; font-weight: 500; font-size: 0.65em;">
           ‚Üê Prev
         </button>`;
      
      const nextButton = nextProblem ? 
        `<button onclick="
           // Show loading animation immediately
           document.getElementById('content').innerHTML = \`
             <div class='content-inner'>
               <div style='text-align: center; padding: 3rem 1rem; color: #656d76;'>
                 <div style='display: inline-block; animation: spin 1s linear infinite; font-size: 2rem; margin-bottom: 1rem;'>‚è≥</div>
                 <p style='margin: 0; font-size: 0.95rem;'>Loading content...</p>
               </div>
             </div>
           \`;
           // Set title immediately
           document.title = '${nextProblem.title} - LeetCode Prep';
           // Navigate and scroll to visible
           router.navigate('${currentListSlug}', '${nextProblem.slug}');
         "
                 title="${nextProblem.title}"
                 style="background: #6f42c1; color: white; border: none; padding: 0.2em 0.5em; border-radius: 3px; cursor: pointer; font-weight: 500; font-size: 0.65em;">
           Next ‚Üí
         </button>` :
        `<button disabled
                 style="background: #f6f8fa; color: #8c959f; border: 1px solid #e1e5e9; padding: 0.2em 0.5em; border-radius: 3px; cursor: not-allowed; font-weight: 500; font-size: 0.65em;">
           Next ‚Üí
         </button>`;
      
      const navigationHTML = `
        <div class="action-buttons">
          ${prevButton}
          <span style="color: #656d76; font-size: 0.7em; margin: 0 0.5em;">${currentIndex + 1} of ${currentListData.length}</span>
          ${nextButton}
          <button id="share-btn" onclick="shareCurrentPage()" style="background: #28a745; color: white; border: none; padding: 0.2em 0.5em; border-radius: 3px; cursor: pointer; font-weight: 500; font-size: 0.65em; margin-left: 0.5em;">üîó Share</button>
          <button id="print-btn" onclick="window.print()" style="background: #0969da; color: white; border: none; padding: 0.2em 0.5em; border-radius: 3px; cursor: pointer; font-weight: 500; font-size: 0.65em;">üñ®Ô∏è Print</button>
        </div>
      `;
      
      return {
        top: navigationHTML
      };
    }

    // Setup navigation event listeners and keyboard shortcuts
    function setupNavigationListeners() {
      // Add keyboard navigation (arrow keys)
      const handleKeyNavigation = (e) => {
        // Only handle if we're not in an input field
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
          return;
        }
        
        const { problemSlug } = router.parseHash();
        if (!problemSlug || !currentListData || currentListData.length === 0) {
          return;
        }
        
        const currentProblem = currentListData.find(p => p.slug === problemSlug);
        if (!currentProblem) return;
        
        const currentIndex = currentListData.indexOf(currentProblem);
        
        if (e.key === 'ArrowLeft' && currentIndex > 0) {
          e.preventDefault();
          const prevProblem = currentListData[currentIndex - 1];
          
          // Show loading animation immediately
          document.getElementById('content').innerHTML = `
            <div class="content-inner">
              <div style="text-align: center; padding: 3rem 1rem; color: #656d76;">
                <div style="display: inline-block; animation: spin 1s linear infinite; font-size: 2rem; margin-bottom: 1rem;">‚è≥</div>
                <p style="margin: 0; font-size: 0.95rem;">Loading content...</p>
              </div>
            </div>
          `;
          
          // Set title immediately
          document.title = `${prevProblem.title} - LeetCode Prep`;
          
          router.navigate(currentListSlug, prevProblem.slug);
        } else if (e.key === 'ArrowRight' && currentIndex < currentListData.length - 1) {
          e.preventDefault();
          const nextProblem = currentListData[currentIndex + 1];
          
          // Show loading animation immediately
          document.getElementById('content').innerHTML = `
            <div class="content-inner">
              <div style="text-align: center; padding: 3rem 1rem; color: #656d76;">
                <div style="display: inline-block; animation: spin 1s linear infinite; font-size: 2rem; margin-bottom: 1rem;">‚è≥</div>
                <p style="margin: 0; font-size: 0.95rem;">Loading content...</p>
              </div>
            </div>
          `;
          
          // Set title immediately
          document.title = `${nextProblem.title} - LeetCode Prep`;
          
          router.navigate(currentListSlug, nextProblem.slug);
        }
      };
      
      // Remove existing listener if any
      document.removeEventListener('keydown', handleKeyNavigation);
      // Add new listener
      document.addEventListener('keydown', handleKeyNavigation);
    }

    // Add difficulty badge classes
    function addDifficultyBadges() {
      document.querySelectorAll('.difficulty-badge').forEach(badge => {
        const difficulty = badge.textContent.toLowerCase();
        badge.classList.add(difficulty);
      });
    }

    // Hide Practice links for printing
    function hidePracticeLinksForPrint() {
      // Find all links that contain "Practice" text and point to leetcode.com
      document.querySelectorAll('a[href*="leetcode.com/problems"]').forEach(link => {
        if (link.textContent.trim().toLowerCase().includes('practice')) {
          link.classList.add('practice-link');
        }
      });
    }

    // Load code list and render its problems in column 2
    function loadCodeListFiles(jsonFile, callback = null) {
      // Check if this is a new list being loaded (compare BEFORE updating currentListSlug)
      const newListSlug = listSlugMap[jsonFile];
      const isNewList = (currentListSlug !== newListSlug);
      
      // Show loading animation in C3 for new list loads with timing pattern
      if (isNewList && !isPageReload) {
        document.getElementById('content').innerHTML = `
          <div class="content-inner">
            <div style="text-align: center; padding: 3rem 1rem; color: #656d76;">
              <div style="display: inline-block; animation: spin 1s linear infinite; font-size: 2rem; margin-bottom: 1rem;">‚è≥</div>
              <p style="margin: 0; font-size: 0.95rem;">Loading list...</p>
            </div>
          </div>
        `;
      }
      
      // Track start time for minimum loading duration
      const loadStartTime = Date.now();
      const minimumLoadTime = 500; // 0.5 second minimum
      
      fetch('data/' + jsonFile)
        .then(res => res.json())
        .then(list => {
          // Calculate remaining time to ensure minimum loading duration
          const loadTime = Date.now() - loadStartTime;
          const remainingTime = Math.max(0, minimumLoadTime - loadTime);
          
          // Delay content display to ensure minimum loading time
          setTimeout(() => {
            currentListData = list;
            currentListSlug = newListSlug; // Update after the comparison
            
            const fileList = document.getElementById('file-list');
            fileList.innerHTML = '';
            
            list.forEach(item => {
              const li = document.createElement('li');
              const a = document.createElement('a');
              const problemUrl = `#${currentListSlug}/${item.slug}`;

              a.href = problemUrl;
              a.textContent = item.title;
              a.onclick = (e) => {
                e.preventDefault();

                // Always show loading animation
                document.getElementById('content').innerHTML = `
                  <div class="content-inner">
                    <div style="text-align: center; padding: 3rem 1rem; color: #656d76;">
                      <div style="display: inline-block; animation: spin 1s linear infinite; font-size: 2rem; margin-bottom: 1rem;">‚è≥</div>
                      <p style="margin: 0; font-size: 0.95rem;">Loading content...</p>
                    </div>
                  </div>
                `;

                // Set title immediately using the actual problem data
                document.title = `${item.title} - LeetCode Prep`;

                // If already on this problem, force reload markdown with loading animation for 0.5s
                const { problemSlug, listSlug } = router.parseHash();
                if (problemSlug === item.slug && listSlug === currentListSlug) {
                  // Show loading for 0.5s, then reload markdown
                  setTimeout(() => {
                    router.loadProblemBySlug(item.slug);
                  }, 500);
                } else {
                  router.navigate(currentListSlug, item.slug);
                }
              };
              li.appendChild(a);
              fileList.appendChild(li);
            });
            
            // Handle C2 scroll: Reset for new lists OR navigation, restore for page reloads
            if (isNewList && !isPageReload) {
              // User navigated to a different list - reset to top
              document.getElementById('sidebar').scrollTop = 0;
              currentMarkdownFile = ''; // Clear current file tracker
            } else if (isPageReload) {
              // Page reload - restore C2 position immediately after content is added
              restoreC2ScrollPosition();
            }
            
            // Only show welcome message if no specific problem is being loaded
            if (!router.parseHash().problemSlug) {
              // Get list name for display
              const listInfo = currentLists.find(l => l.file === jsonFile);
              const listName = listInfo ? listInfo.name : 'Problem List';
              
              document.getElementById('content').innerHTML = `
                <div class="content-inner">
                  <div class="action-buttons">
                    <button id="start-btn" style="background: #6f42c1; color: white; border: none; padding: 0.2em 0.5em; border-radius: 3px; cursor: pointer; font-weight: 500; font-size: 0.65em; margin-right: 0.5em;">‚ñ∂Ô∏è Start</button>
                    <button id="random-btn" style="background: #dc3545; color: white; border: none; padding: 0.2em 0.5em; border-radius: 3px; cursor: pointer; font-weight: 500; font-size: 0.65em; margin-right: 0.5em;">üé≤ Random</button>
                    <button id="share-list-btn" style="background: #28a745; color: white; border: none; padding: 0.2em 0.5em; border-radius: 3px; cursor: pointer; font-weight: 500; font-size: 0.65em;">üîó Share List</button>
                  </div>
                  <h2>${listName}</h2>
                  <p>Select a problem from the list to view its solution and explanation.</p>
                  <p><strong>${list.length}</strong> problems in this list</p>
                </div>
              `;
              
              // Add event listener for start button
              document.getElementById('start-btn').onclick = function() {
                if (list.length > 0) {
                  // Show loading animation immediately
                  document.getElementById('content').innerHTML = `
                    <div class="content-inner">
                      <div style="text-align: center; padding: 3rem 1rem; color: #656d76;">
                        <div style="display: inline-block; animation: spin 1s linear infinite; font-size: 2rem; margin-bottom: 1rem;">‚è≥</div>
                        <p style="margin: 0; font-size: 0.95rem;">Loading content...</p>
                      </div>
                    </div>
                  `;
                  
                  // Set title immediately
                  document.title = `${list[0].title} - LeetCode Prep`;
                  
                  router.navigate(currentListSlug, list[0].slug);
                }
              };
              
              // Add event listener for random button
              document.getElementById('random-btn').onclick = function() {
                if (list.length > 0) {
                  // Pick a random problem from the list
                  const randomIndex = Math.floor(Math.random() * list.length);
                  const randomProblem = list[randomIndex];
                  
                  // Show loading animation immediately
                  document.getElementById('content').innerHTML = `
                    <div class="content-inner">
                      <div style="text-align: center; padding: 3rem 1rem; color: #656d76;">
                        <div style="display: inline-block; animation: spin 1s linear infinite; font-size: 2rem; margin-bottom: 1rem;">‚è≥</div>
                        <p style="margin: 0; font-size: 0.95rem;">Loading random problem...</p>
                      </div>
                    </div>
                  `;
                  
                  // Set title immediately
                  document.title = `${randomProblem.title} - LeetCode Prep`;
                  
                  router.navigate(currentListSlug, randomProblem.slug);
                }
              };
              
              // Add event listener for list share button
              document.getElementById('share-list-btn').onclick = function() {
                const listUrl = `${window.location.origin}${window.location.pathname}#${currentListSlug}`;
                shareUrl(listUrl, `${listName} - LeetCode Prep`);
              };
            }
            
            // Execute callback if provided (used for initial routing)
            if (callback) callback();
          }, remainingTime);
        })
        .catch(() => {
          document.getElementById('file-list').innerHTML = "<li>Failed to load list.</li>";
          document.getElementById('content').innerHTML = `
            <div class="content-inner">
              <h2>Error</h2>
              <p>Failed to load the problem list.</p>
            </div>
          `;
        });
    }
  </script>
</body>
</html>